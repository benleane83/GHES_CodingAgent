trigger: none

pool:
  vmImage: ubuntu-latest

resources:
  webhooks:
    - webhook: myWebhookResource
      connection: WorkItemUpdatedWH

variables:
  - group: "GitHub Copilot CLI"
  - name: MODEL
    value: claude-haiku-4.5
  - name: COPILOT_VERSION
    value: 0.0.353

steps:
  - script: echo "[ROCKET] Webhook triggered pipeline started!"

  - bash: |
      cat > /tmp/webhook_payload.json <<'EOF'
      ${{ convertToJson(parameters.myWebhookResource) }}
      EOF
      echo "[JSON] Payload JSON:"
      cat /tmp/webhook_payload.json | jq . 2>/dev/null || cat /tmp/webhook_payload.json
    displayName: '[JSON] Display Raw Webhook Payload'

  - bash: |
      echo "==============================================="
      echo "ğŸ“Œ EVENT INFORMATION"
      echo "==============================================="
      echo "ğŸ†” Event ID: ${{ parameters.myWebhookResource.id }}"
      echo "ğŸ“¨ Event Type: ${{ parameters.myWebhookResource.eventType }}"
      echo "ğŸ¢ Publisher ID: ${{ parameters.myWebhookResource.publisherId }}"
      echo "ğŸ• Created Date: ${{ parameters.myWebhookResource.createdDate }}"
      echo ""
      echo "==============================================="
      echo "ğŸ’¬ MESSAGE"
      echo "==============================================="
      echo "ğŸ“ Text: ${{ parameters.myWebhookResource.message.text }}"
      echo ""
      echo "==============================================="
      echo "ğŸ“‹ DETAILED MESSAGE"
      echo "==============================================="
      echo "ğŸ“ Text: ${{ parameters.myWebhookResource.detailedMessage.text }}"
      echo ""
      echo "==============================================="
      echo "ğŸ‘¤ RESOURCE - UPDATED BY"
      echo "==============================================="
      echo "ğŸ‘¤ User Name: ${{ parameters.myWebhookResource.resource.revisedBy.displayName }}"
      echo "ğŸ†” User ID: ${{ parameters.myWebhookResource.resource.revisedBy.id }}"
      echo "ğŸ“§ Unique Name: ${{ parameters.myWebhookResource.resource.revisedBy.uniqueName }}"
      echo ""
      echo "==============================================="
      echo "ï¿½ WORK ITEM INFORMATION"
      echo "==============================================="
      echo "ğŸ†” Work Item ID: ${{ parameters.myWebhookResource.resource.revision.fields['System.Id'] }}"
      echo "ğŸ“ Title: ${{ parameters.myWebhookResource.resource.revision.fields['System.Title'] }}"
      echo "ğŸ”– Type: ${{ parameters.myWebhookResource.resource.revision.fields['System.WorkItemType'] }}"
      echo "ğŸ”„ State: ${{ parameters.myWebhookResource.resource.revision.fields['System.State'] }}"
      echo "ğŸ’¡ Reason: ${{ parameters.myWebhookResource.resource.revision.fields['System.Reason'] }}"
      echo "ğŸ“ Project: ${{ parameters.myWebhookResource.resource.revision.fields['System.TeamProject'] }}"
      echo "ï¿½ Area: ${{ parameters.myWebhookResource.resource.revision.fields['System.AreaPath'] }}"
      echo "ğŸ” Iteration: ${{ parameters.myWebhookResource.resource.revision.fields['System.IterationPath'] }}"
      echo ""
      echo "==============================================="
      echo "ğŸ‘¥ ASSIGNMENT INFORMATION"
      echo "==============================================="
      echo "ğŸ‘¤ Created By: ${{ parameters.myWebhookResource.resource.revision.fields['System.CreatedBy'].displayName }}"
      echo "âœï¸ Changed By: ${{ parameters.myWebhookResource.resource.revision.fields['System.ChangedBy'].displayName }}"
      echo "ğŸ“… Created Date: ${{ parameters.myWebhookResource.resource.revision.fields['System.CreatedDate'] }}"
      echo "ğŸ“… Changed Date: ${{ parameters.myWebhookResource.resource.revision.fields['System.ChangedDate'] }}"
      echo ""
      echo "==============================================="
      echo "ğŸ”€ FIELD CHANGES"
      echo "==============================================="
      echo "ğŸ“Š Revision Number:"
      echo "   Old: ${{ parameters.myWebhookResource.resource.fields['System.Rev'].oldValue }}"
      echo "   New: ${{ parameters.myWebhookResource.resource.fields['System.Rev'].newValue }}"
      echo ""
      echo "ğŸ”„ State Change:"
      echo "   Old: ${{ parameters.myWebhookResource.resource.fields['System.State'].oldValue }}"
      echo "   New: ${{ parameters.myWebhookResource.resource.fields['System.State'].newValue }}"
      echo ""
      echo "ğŸ’¡ Reason Change:"
      echo "   Old: ${{ parameters.myWebhookResource.resource.fields['System.Reason'].oldValue }}"
      echo "   New: ${{ parameters.myWebhookResource.resource.fields['System.Reason'].newValue }}"
      echo ""
      echo "ğŸ‘¥ Assignment Change:"
      echo "   Old: ${{ parameters.myWebhookResource.resource.fields['System.AssignedTo'].oldValue }}"
      echo "   New: ${{ parameters.myWebhookResource.resource.fields['System.AssignedTo'].newValue }}"
      echo ""
      echo "ğŸ”´ Severity Change:"
      echo "   Old: ${{ parameters.myWebhookResource.resource.fields['Microsoft.VSTS.Common.Severity'].oldValue }}"
      echo "   New: ${{ parameters.myWebhookResource.resource.fields['Microsoft.VSTS.Common.Severity'].newValue }}"
      echo ""
      echo "==============================================="
      echo "ğŸ¢ RESOURCE CONTAINERS"
      echo "==============================================="
      echo "ğŸ“¦ Collection ID: ${{ parameters.myWebhookResource.resourceContainers.collection.id }}"
      echo "ğŸ¢ Account ID: ${{ parameters.myWebhookResource.resourceContainers.account.id }}"
      echo "ğŸ“Š Project ID: ${{ parameters.myWebhookResource.resourceContainers.project.id }}"
      echo ""
      
    displayName: ğŸ“‹ Show Webhook Event Data


