trigger: none

pool:
  vmImage: ubuntu-latest

resources:
  webhooks:
    - webhook: myWebhookResource
      connection: GHCopilotWH

variables:
  - group: 'GitHub Copilot CLI'

steps:
  - checkout: none
  - script: echo "ğŸš€ Webhook triggered pipeline started!"
    displayName: ğŸš€ Webhook triggered

  - bash: |
      # Access webhook data as parameter
      echo "ğŸ”” Processing webhook payload..."
      echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo "ğŸ“‹ WEBHOOK INFORMATION"
      echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo ""
      echo "ğŸ”– Event Type: ${{ parameters.myWebhookResource.eventType }}"
      echo "ğŸ†” Subscription ID: ${{ parameters.myWebhookResource.subscriptionId }}"
      echo "ğŸ”‘ Notification ID: ${{ parameters.myWebhookResource.notificationId }}"
      echo "ğŸ¯ Event ID: ${{ parameters.myWebhookResource.id }}"
      echo "ğŸ“¡ Publisher ID: ${{ parameters.myWebhookResource.publisherId }}"
      echo "ğŸ“… Created Date: ${{ parameters.myWebhookResource.createdDate }}"
      echo "ğŸ”¢ Resource Version: ${{ parameters.myWebhookResource.resourceVersion }}"
      echo ""
      echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo "ğŸ’¬ MESSAGE"
      echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo ""
      echo "${{ parameters.myWebhookResource.message.text }}"
      echo ""
      echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo "ğŸ“ WORK ITEM DETAILS (from webhook)"
      echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo ""
      echo "ğŸ†” Work Item ID: ${{ parameters.myWebhookResource.resource.id }}"
      echo "ğŸ”„ Revision: ${{ parameters.myWebhookResource.resource.rev }}"
      echo "ğŸ“Œ Title: ${{ parameters.myWebhookResource.resource.fields['System.Title'] }}"
      echo "ğŸ·ï¸  Type: ${{ parameters.myWebhookResource.resource.fields['System.WorkItemType'] }}"
      echo "ğŸ“Š State: ${{ parameters.myWebhookResource.resource.fields['System.State'] }}"
      echo "â“ Reason: ${{ parameters.myWebhookResource.resource.fields['System.Reason'] }}"
      echo "ğŸ¯ Priority: ${{ parameters.myWebhookResource.resource.fields['Microsoft.VSTS.Common.Priority'] }}"
      echo ""
      echo "ğŸ“„ Description:"
      echo "${{ parameters.myWebhookResource.resource.fields['System.Description'] }}"
      echo ""
      echo "ğŸ‘¤ Created By: ${{ parameters.myWebhookResource.resource.fields['System.CreatedBy'] }}"
      echo "ğŸ“… Created Date: ${{ parameters.myWebhookResource.resource.fields['System.CreatedDate'] }}"
      echo ""
      echo "ğŸ‘¥ Assigned To: ${{ parameters.myWebhookResource.resource.fields['System.AssignedTo'] }}"
      echo ""
      echo "ğŸ”„ Changed By: ${{ parameters.myWebhookResource.resource.fields['System.ChangedBy'] }}"
      echo "ğŸ“… Changed Date: ${{ parameters.myWebhookResource.resource.fields['System.ChangedDate'] }}"
      echo ""
      echo "ğŸ“‚ Area Path: ${{ parameters.myWebhookResource.resource.fields['System.AreaPath'] }}"
      echo "ğŸ” Iteration Path: ${{ parameters.myWebhookResource.resource.fields['System.IterationPath'] }}"
      echo "ğŸ“ Team Project: ${{ parameters.myWebhookResource.resource.fields['System.TeamProject'] }}"
      echo ""
      echo "âš ï¸  Severity: ${{ parameters.myWebhookResource.resource.fields['Microsoft.VSTS.Common.Severity'] }}"
      echo "ğŸ“‹ Kanban Column: ${{ parameters.myWebhookResource.resource.fields['WEF_EB329F44FE5F4A94ACB1DA153FDF38BA_Kanban.Column'] }}"
      echo ""
      echo "ğŸ”— Work Item URL: ${{ parameters.myWebhookResource.resource.url }}"
      echo ""
      echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      # Set pipeline variables for later use
      echo "##vso[task.setvariable variable=WorkItemId]${{ parameters.myWebhookResource.resource.id }}"
      echo "##vso[task.setvariable variable=WorkItemTitle]${{ parameters.myWebhookResource.resource.fields['System.Title'] }}"
      echo "##vso[task.setvariable variable=WorkItemType]${{ parameters.myWebhookResource.resource.fields['System.WorkItemType'] }}"
      echo "##vso[task.setvariable variable=WorkItemState]${{ parameters.myWebhookResource.resource.fields['System.State'] }}"
      echo "##vso[task.setvariable variable=WorkItemCreatedBy]${{ parameters.myWebhookResource.resource.fields['System.CreatedBy'] }}"
      echo "##vso[task.setvariable variable=WorkItemAssignedTo]${{ parameters.myWebhookResource.resource.fields['System.AssignedTo'] }}"
      echo "##vso[task.setvariable variable=WorkItemDescription]${{ parameters.myWebhookResource.resource.fields['System.Description'] }}"
    displayName: Display webhook information ğŸ“Š

  - bash: |
      npm install -g @github/copilot
    displayName: ğŸ¤– Install GitHub Copilot CLI 
  
  - bash: |
      # Example usage of GitHub Copilot CLI
      copilot --help
    displayName: ğŸ¤– Verify GitHub Copilot CLI Installation

  - bash: |
      echo "ğŸ¤– Running GitHub Copilot CLI to test that it works"     
      copilot -p "Puedes decirme de quÃ© trata este proyecto" --allow-all-tools
    displayName: ğŸ¤– Verify GitHub Copilot CLI Installation

